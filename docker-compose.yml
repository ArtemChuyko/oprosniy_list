version: '3.8'

services:
  questionnaire-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: questionnaire-app
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # Node.js
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
      
      # Uploads directory (inside container)
      - UPLOADS_DIR=/app/uploads
      
      # SMTP Configuration
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_FROM=${SMTP_FROM:-${SMTP_USER}}
      
      # Email recipient
      - OWNER_EMAIL=${OWNER_EMAIL}
      
      # Admin authentication
      - ADMIN_SECRET=${ADMIN_SECRET}
    volumes:
      # Persist form data
      - ./data:/app/data
      # Persist uploads (optional, for data persistence across container restarts)
      - uploads:/app/uploads
    networks:
      - questionnaire-network

volumes:
  uploads:
    driver: local

networks:
  questionnaire-network:
    driver: bridge
